name: RDP-Cyber-Engineer-Deep-Stealth

on:
  workflow_dispatch: 

jobs:
  rdp-job:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù‡Ø§Ø² Ø­Ù‚ÙŠÙ‚ÙŠ (Hardware Masking)
      - name: System Identity Masking
        shell: powershell
        run: |
          # ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù„Ø§Ø³Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙŠØ´Ø¨Ù‡ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
          $randomName = "PC-" + (Get-Random -Minimum 1000 -Maximum 9999)
          Rename-Computer -NewName $randomName -ErrorAction SilentlyContinue
          
          # ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ Registry Ù„Ø¥ÙŠÙ‡Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø£Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„ÙŠØ³ Virtual Machine
          $registryPath = "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion"
          Set-ItemProperty -Path $registryPath -Name "ProductId" -Value "00330-80000-00000-AA948"
          
          # Ø¶Ø¨Ø· Ø§Ù„Ù€ DNS Ù„ØªØ¬Ø§ÙˆØ² Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª
          Set-DnsClientServerAddress -InterfaceAlias (Get-NetAdapter).Name -ServerAddresses ("1.1.1.1", "8.8.8.8")

      # 2. ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ±Ø³Ø§Ù†Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
      - name: Install Advanced Engineering Arsenal
        shell: powershell
        run: |
          # ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù…Ø¹ ØªÙØ¹ÙŠÙ„ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ®ÙÙŠ
          choco install ffmpeg yt-dlp googlechrome brave internet-download-manager vscode git 7zip aria2 -y
          
          # Ø¨Ø§ÙŠØ«ÙˆÙ† Ù…Ø¹ Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹ÙƒØ³ÙŠØ© ÙˆØ§Ù„ØªØ®ÙÙŠ
          python -m pip install --upgrade pip
          pip install yt-dlp playwright cloudscraper fake-useragent requests undetected-chromedriver selenium-stealth auto-py-to-exe pycryptodome aiohttp
          
          # ØªØ«Ø¨ÙŠØª Playwright Ù…Ø¹ Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªÙ†ÙˆØ¹
          python -m playwright install --with-deps

      # 3. Ø¥Ø¹Ø¯Ø§Ø¯ "Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø®Ø§Ø±Ù‚" Ù„Ù„ØªØ­Ù…ÙŠÙ„ (Advanced yt-dlp Layer)
      - name: Configure Stealth Downloader Layer
        shell: powershell
        run: |
          $ua = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36"
          $configPath = "$env:USERPROFILE\yt-dlp.conf"
          
          # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¹Ù‚Ø¯Ø©: ØªØ´Ù…Ù„ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©ØŒ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø­Ù…Ø§Ù„
          @(" --user-agent `"$ua`"",
            " --referer `"https://www.google.com/`"",
            " --add-header `"Accept-Language: en-US,en;q=0.9,ar-SA;q=0.8`"",
            " --geo-bypass",
            " --fragment-retries infinite",
            " --external-downloader aria2c", # Ø§Ø³ØªØ®Ø¯Ø§Ù… aria2 Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ù„Ø³Ø±Ø¹Ø© Ø¬Ù†ÙˆÙ†ÙŠØ©
            " --external-downloader-args `"aria2c:-x 16 -s 16 -k 1M`"",
            " --cookies-from-browser brave", # Ù…Ø­Ø§ÙˆÙ„Ø© Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆÙƒÙŠØ² ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø¨Ø±ÙŠÙ
            " --no-check-certificates"
          ) | Out-File -FilePath $configPath -Encoding utf8

      # 4. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù€ RDP Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ù„ØºØ§Øª
      - name: RDP & Localization Deep Setup
        shell: powershell
        run: |
          Install-Language ar-SA -ErrorAction SilentlyContinue
          Set-WinUserLanguageList -LanguageList en-US, ar-SA -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          $password = "GitHub@Expert#2025"
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          New-LocalUser -Name "Cyber_Admin" -Password $securePass -AccountNeverExpires
          Add-LocalGroupMember -Group "Administrators" -Member "Cyber_Admin"
          echo "RDP_PASS=$password" >> $env:GITHUB_ENV

      # 5. Ø§ØªØµØ§Ù„ Ø´Ø¨ÙƒØ© Tailscale Ø§Ù„Ù…Ø´ÙØ±Ø©
      - name: Tailscale Mesh Connection
        shell: powershell
        run: |
          $url = "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi"
          $out = "$env:TEMP\tailscale.msi"
          Invoke-WebRequest -Uri $url -OutFile $out
          Start-Process msiexec.exe -ArgumentList "/i $out /quiet /norestart" -Wait
          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=Cyber-Runner-X
          $tsIp = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
          echo "TS_IP=$tsIp" >> $env:GITHUB_ENV

      # 6. Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ (Engineer Dashboard)
      - name: Connection Dashboard
        shell: powershell
        run: |
          Write-Host "`n" + ("#"*60) -ForegroundColor Cyan
          Write-Host "ğŸ›¸ DEEP-STEALTH CYBER WORKSTATION ACTIVE" -ForegroundColor Magenta
          Write-Host ("#"*60)
          Write-Host "ğŸŒ Tailscale IP : $env:TS_IP" -ForegroundColor Yellow
          Write-Host "ğŸ‘¤ Admin User   : Cyber_Admin"
          Write-Host "ğŸ”‘ Credentials  : $env:RDP_PASS" -ForegroundColor Red
          Write-Host "ğŸš€ Acceleration : Aria2 + High Performance Mode" -ForegroundColor Green
          Write-Host "ğŸ­ Masking      : Hardware Spoofing Active" -ForegroundColor Blue
          Write-Host ("#"*60)

      # 7. Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… (Stability Engine)
      - name: System Stability Engine
        shell: powershell
        run: |
          while ($true) {
            # ØªÙØ±ÙŠØº Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØ§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
            [System.GC]::Collect()
            Get-Process | Where-Object { $_.WorkingSet -gt 500MB -and $_.ProcessName -notlike "*explorer*" } | Stop-Process -Force -ErrorAction SilentlyContinue
            Write-Host "[$(Get-Date)] System optimized. Monitoring connections..." -ForegroundColor Gray
            Start-Sleep -Seconds 300
          }
